<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>临时课表测试</title>
  <style>
    body { font-family: Arial, "Microsoft Yahei", sans-serif; padding: 20px; }
    .controls { margin-bottom: 12px; }
    .day { border: 1px solid #ddd; padding: 8px; margin: 6px 0; }
    .course { padding: 6px; border-bottom: 1px dashed #eee; }
    .course:last-child { border-bottom: none; }
    .meta { color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <h2>临时课表测试</h2>
  <div class="controls">
    周次: <input id="weekInput" type="number" value="1" min="1" max="30" style="width:60px"> 
    <button id="showBtn">显示</button>
    <button id="loadExample">加载示例数据</button>
  </div>

  <div id="result"></div>

  <script src="courses_data.js"></script>
  <script>
    // 备用数据（当 coursesData 未定义时使用）
    const fallback = window.coursesData || [
      {name:'示例课程',classId:'S001',time:'1-4周星期一1-2节',location:'A101',teacher:'张老师',weeks:[1,2,3,4],weekday:'一',periods:'1-2节'}
    ];

    function getData(){
      return window.coursesData && window.coursesData.length ? window.coursesData : fallback;
    }

    function renderWeek(week){
      const data = getData();
      const weekdays = { '一':[], '二':[], '三':[], '四':[], '五':[], '六':[], '日':[] };
      const other = [];
      data.forEach(c => {
        if (Array.isArray(c.weeks) && c.weeks.includes(week)){
          const wd = c.weekday || '';
          if (wd && weekdays[wd]) weekdays[wd].push(c);
          else other.push(c);
        }
      });

      const container = document.getElementById('result');
      container.innerHTML = `<h3>第 ${week} 周（共 ${data.filter(x=>Array.isArray(x.weeks)&&x.weeks.includes(week)).length} 个课程）</h3>`;
      for (let wd of ['一','二','三','四','五','六','日']){
        const list = weekdays[wd];
        const dayDiv = document.createElement('div');
        dayDiv.className = 'day';
        dayDiv.innerHTML = `<strong>星期${wd}</strong>` + (list.length?` <span class="meta">共 ${list.length} 门</span>`:' <span class="meta">（无）</span>');
        if (list.length){
          list.forEach(c => {
            const d = document.createElement('div'); d.className='course';
            d.innerHTML = `<div><strong>${c.name}</strong> <span class="meta">${c.periods}</span></div><div class="meta">${c.location} / ${c.teacher}</div>`;
            dayDiv.appendChild(d);
          })
        }
        container.appendChild(dayDiv);
      }

      if (other.length){
        const dayDiv = document.createElement('div'); dayDiv.className='day';
        dayDiv.innerHTML = `<strong>未指定星期或不规则项</strong> <span class="meta">共 ${other.length} 项</span>`;
        other.forEach(c=>{
          const d = document.createElement('div'); d.className='course';
          d.innerHTML = `<div><strong>${c.name}</strong> <span class="meta">${c.time}</span></div><div class="meta">${c.location} / ${c.teacher}</div>`;
          dayDiv.appendChild(d);
        })
        container.appendChild(dayDiv);
      }
    }

    document.getElementById('showBtn').addEventListener('click', ()=>{
      const wk = parseInt(document.getElementById('weekInput').value || '1', 10);
      renderWeek(wk);
    });

    document.getElementById('loadExample').addEventListener('click', ()=>{
      window.coursesData = fallback; renderWeek(parseInt(document.getElementById('weekInput').value||'1',10));
    });

    // 初始渲染
    document.addEventListener('DOMContentLoaded', ()=>{
      renderWeek(parseInt(document.getElementById('weekInput').value||'1',10));
    });
  </script>
</body>
</html>
